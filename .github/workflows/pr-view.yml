name: ü§ñ AI PR Reviewer Bot (Updated Version)

on:
  pull_request:
    types: [opened, synchronize, reopened]

permissions:
  contents: read
  pull-requests: write
  issues: write

jobs:
  review:
    runs-on: ubuntu-latest

    steps:
      # 1Ô∏è‚É£ Checkout the repository
      - name: Checkout repository
        uses: actions/checkout@v4

      # 2Ô∏è‚É£ Set up Python
      - name: Set up Python
        uses: actions/setup-python@v5
        with:
          python-version: "3.10"

      # 3Ô∏è‚É£ Install dependencies
      - name: Install dependencies
        run: pip install requirements.txt

      # 4Ô∏è‚É£ Run the AI Reviewer system
      - name: Run Enhanced AI Reviewer (static + RAG + meta)
        env:
          OWNER: hetrank
          REPO: PULL-PANDA
          PR_NUMBER: ${{ github.event.pull_request.number }}
          GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
          GROQ_API_KEY: ${{ secrets.GROQ_API_KEY }}
          PINECONE_API_KEY: ${{ secrets.PINECONE_API_KEY }}
          PINECONE_INDEX_NAME: pullpanda-index
        run: python main.py

      #  5Ô∏è‚É£ (Optional) Upload generated reviews and reports as artifacts
      # - name: Upload AI Review Reports
      #   if: always()
      #   uses: actions/upload-artifact@v4
      #   with:
      #     name: ai-review-reports
      #     path: |
      #       review_*.md
      #       review_reports_all_prompts_*.md
      #       review_reports_all_prompts_*.csv
      #       iterative_results_*.json
      #       selector_state.json
